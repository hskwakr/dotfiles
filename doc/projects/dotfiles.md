# dotfiles プロジェクト

このドキュメントでは、本リポジトリの dotfiles が何を指すのか、インストールスクリプトのバックアップ機構、そして `clean.sh` を利用した復元方法について説明します。

## dotfiles とは何か

一般的に "dotfiles" とは、ユーザーのホームディレクトリに置かれる設定ファイルや設定ディレクトリを指します。`~/.bashrc` や `~/.vimrc` のように名前の先頭がドット (`.`) で始まることからこのように呼ばれます。本リポジトリでは、これらの設定を Git 管理下に置き、複数の環境で同じ設定を簡単に再現できるようにしています。

## `install.sh` のバックアップ機構

`bin/install.sh` を実行すると、既存の dotfiles を安全に置き換えるために次の手順でバックアップを作成します。

1. `$HOME` に既に同名のファイルが存在する場合、まず `backups/original/` 以下に元のファイルをディレクトリ構造を保ったまま保存します。これが「オリジナルバックアップ」となり、一度だけ作成されます。
2. その後、`backups/` 直下にタイムスタンプ付きのバックアップを作成します。古いバックアップは一定数を超えると自動的に削除されます。
3. バックアップ後にシンボリックリンクを張り直し、新しい dotfiles を有効にします。

この仕組みにより、誤って既存の設定を失うことなく dotfiles を管理できます。

## `clean.sh` による復元方法

`bin/clean.sh` はインストール時に作成されたバックアップやログを整理し、必要に応じてオリジナルバックアップからファイルを復元します。オプションを何も指定せずに実行すると、復元・整理・ログ削除まで一通り行われます。復元だけを行いたい場合は `-r` を指定してください。復元処理では `backups/original/` から対応するファイルを `$HOME` 配下にコピーし、同名のシンボリックリンクが存在すれば削除してから復元します。

バックアップの整理や不要なログの削除も `clean.sh` でまとめて行えるため、インストール後のメンテナンスに便利です。

## 例: 初回インストールと復元の流れ

以下の手順は、dotfiles を初めて導入する際と、バックアップから元の状態へ戻す場合の一例です。

### 初回インストール

1. リポジトリをクローンして `install.sh` を実行します。
   ```sh
   git clone https://github.com/hskwakr/dotfiles.git ~/dotfiles
   cd ~/dotfiles
   bin/install.sh
   ```
   もしくは次のワンライナーを実行すると、クローンと同時にインストールまで完了します。
   ```sh
   bash -c "$(curl -fsSL https://raw.githubusercontent.com/hskwakr/dotfiles/main/bin/install.sh)"
   ```
   実行後は `$HOME` にシンボリックリンクが作成され、既存ファイルは `backups/original/` へ保存されます。

### バックアップの復元

1. `clean.sh` を引数なしで実行してオリジナルバックアップから復元します。
   ```sh
   cd ~/dotfiles
   bin/clean.sh
   ```
   すべての処理が順に実行され、`$HOME` のリンク解除と `backups/original/` からの復元、古いバックアップやログの整理も行われます。復元だけでよい場合は `-r` を指定してください。
