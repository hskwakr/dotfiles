# プロジェクト向けシェルスクリプトの指針

このドキュメントでは、プロジェクト内でシェルスクリプトを書く際に推奨される基本
設定と設計上の注意点をまとめています。

## 推奨設定

- スクリプトの冒頭で `set -euo pipefail` を有効にし、エラーが発生したら即座に終了
  するようにします。
- `git` や `curl` など外部コマンドを利用する場合は `command -v <コマンド>` で存在を
  確認し、見つからない場合は安全に終了します。
- 変数展開時は `"${var}"` のように必ず引用して予期しない分割やグロブ展開を防ぎま
  す。

## 設計上のポイント

- それぞれの処理を関数にまとめ、再利用しやすいモジュール構成を目指します。
- 大きな処理を複数の小さな関数に分割し、テストや保守を容易にします。
- 処理の開始・完了・エラー発生時には `log` 関数や `echo` を用いて、利用者に分かりやすいメッセージを表示します。
  例:
  ```sh
  log "setup started"
  # ...
  log "setup finished"
  ```

より広い方針については [../agents/overview.md](../agents/overview.md) も参照してください。

## テスト方針 <a id="test-policy"></a>

- スクリプトを変更した際は、BATS を用いたユニットテストを作成・更新します。
- テストファイルは `test/` ディレクトリに配置します。
- 実行方法は [testing.md](testing.md) を参照してください。

## コメント保守 <a id="comment-maintenance"></a>

- 関数定義の直前には、その処理内容を示すコメントを記述します。
- コードを変更した際は、コメントも最新の状態に更新してください。
- コメントと実装が一致していることを PR 前に必ず確認します。
