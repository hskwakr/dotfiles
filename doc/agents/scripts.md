# スクリプト解説

このページでは `bin/` ディレクトリに置かれている主なスクリプトと、`env/` ディレクトリとの連携方法について説明します。

## `install.sh`

- リポジトリをクローンし、ホームディレクトリへ各種 dotfiles のシンボリックリンクを作成します。
- `env/common/` 以下に置かれた設定ファイルもリンク対象となり、環境に依存しない共通設定を一括で適用します。また、必要に応じて `env/` 以下の各ディレクトリから環境固有の設定を手動でリンクすることも想定しています。
- 既存の設定は `backups/` 以下に時刻付きで保存されるため、過去の状態をいつでも復元できます。

### OS 判定と環境別ファイルの選択 <a id="os-detection"></a>

`install.sh` では実行環境を検出するために `detect_os` 関数を使用します。`uname` と `/etc/os-release` を参照し、WSL 上の Ubuntu であれば `wsl-ubuntu`、Fedora であれば `fedora` のように識別結果を返します。

現在は `env/common/` のみを自動でリンクしていますが、将来的には `detect_os` の返り値に基づき `env/<OS>/` ディレクトリも自動的に処理する予定です。たとえば `wsl-ubuntu` という結果であれば `env/wsl-ubuntu/` を優先して参照し、存在しなければ `env/wsl/` などより一般的なディレクトリを利用するといった挙動を想定しています。

この仕組みにより Fedora 環境では `env/fedora/`、WSL 上の Ubuntu では `env/wsl-ubuntu/` を適用するといった柔軟な構成を目指しています。

## `clean.sh`

- `install.sh` が作成したバックアップやログを整理します。`env/` 配下からリンクされたファイルのバックアップも対象です。
- `-r` オプションを指定すると `backups/original/` から元のファイルを復元します。オプションを何も指定しない場合は復元を含むすべての処理を実行しますが、`-b` や `-l` など他のオプションを指定して `-r` を付けない場合、復元処理は実行されません。
- 不要になったログや古いバックアップの削除もこのスクリプトにまとめられています。

## `list.sh`

- `dotfiles` リポジトリに含まれるファイル一覧を表示します。`env/` 以下の環境別ファイルは対象外です。
- `.git` など管理に不要な項目は自動的に除外されます。環境別の設定を確認したい場合は `env/` ディレクトリを参照してください。

## ドキュメント更新ガイドライン

スクリプトを変更した際は、以下の点を必ず確認してください。

1. 変更内容に合わせて本ファイルおよび関連ドキュメントを更新する。
2. 新たに追加したオプションや挙動は、`doc/index.md` から辿れるようリンクを追記する。
3. 更新履歴や注意点をコメントとしてスクリプト内にも残す。

